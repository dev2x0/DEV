name: Windows RDP with Ngrok

on:
  push:
    branches: [ main ]

jobs:
  rdp:
    runs-on: windows-latest
    steps:
      - name: Enable Remote Desktop
        run: |
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server'-name "fDenyTSConnections" -Value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
      - name: Download and Extract Ngrok
        run: |
          Invoke-WebRequest -Uri https://bin.equinox.io/c/4VmDzA7iaHb/ngrok-stable-windows-amd64.zip -OutFile ngrok.zip
          Expand-Archive ngrok.zip -DestinationPath $env:USERPROFILE\ngrok
      - name: Authenticate Ngrok
        run: |
          C:\Users\runneradmin\ngrok\ngrok.exe authtoken 2SNrz3oV02bhYfbpCZNHucKXkRD_49Yis4WD9JLQbAvk8cAcJ
      - name: Start Ngrok Tunnel
        run: |
          C:\Users\runneradmin\ngrok\ngrok.exe tcp 3389
